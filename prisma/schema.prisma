// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Cliente (médico o farmacia)
model Cliente {
  id              String    @id @default(cuid())
  colegiado       String?
  especialidad    String?
  nombre          String
  apellido        String
  direccion       String
  municipio       String
  departamento    String
  tipo            String    // "medico" o "farmacia"
  telefono        String?
  email           String?
  notas           String?
  activo          Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  visitas         Visita[]
  citas           Cita[]
  planificaciones PlanificacionDetalle[]
}

// Medicamento
model Medicamento {
  id                      String    @id @default(cuid())
  nombre                  String
  descripcion             String?
  precioPublico           Float
  precioFarmacia          Float
  bonificacion2a9         String?   // descripción de la bonificación
  bonificacion10Mas       String?   // descripción de la bonificación con 10% descuento
  precioMedico            Float
  oferta                  Boolean   @default(false)
  ofertaDescripcion       String?
  stock                   Int       @default(0)
  activo                  Boolean   @default(true)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  ventaItems              VentaItem[]
}

// Planificación semanal
model Planificacion {
  id            String    @id @default(cuid())
  fechaInicio   DateTime
  fechaFin      DateTime
  tipo          String    // "semanal" o "mensual"
  notas         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  detalles      PlanificacionDetalle[]
}

// Detalle de planificación (día por día)
model PlanificacionDetalle {
  id              String    @id @default(cuid())
  planificacionId String
  dia             String    // "lunes", "martes", etc.
  fecha           DateTime
  giro            String
  horario         String
  direccion       String
  clienteId       String?
  notas           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  planificacion   Planificacion @relation(fields: [planificacionId], references: [id], onDelete: Cascade)
  cliente         Cliente?     @relation(fields: [clienteId], references: [id])
}

// Visita a cliente
model Visita {
  id            String    @id @default(cuid())
  clienteId     String
  fecha         DateTime
  notas         String?
  totalVenta    Float     @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  cliente       Cliente     @relation(fields: [clienteId], references: [id])
  ventas        Venta[]
}

// Venta realizada durante visita
model Venta {
  id            String    @id @default(cuid())
  visitaId      String
  fecha         DateTime  @default(now())
  total         Float     @default(0)
  notas         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  visita        Visita      @relation(fields: [visitaId], references: [id], onDelete: Cascade)
  items         VentaItem[]
}

// Item de venta (medicamento vendido)
model VentaItem {
  id                String    @id @default(cuid())
  ventaId           String
  medicamentoId     String
  cantidad          Int
  precioUnitario    Float
  subtotal          Float
  createdAt         DateTime  @default(now())

  venta             Venta        @relation(fields: [ventaId], references: [id], onDelete: Cascade)
  medicamento       Medicamento  @relation(fields: [medicamentoId], references: [id])
}

// Cita
model Cita {
  id            String    @id @default(cuid())
  clienteId     String
  titulo        String
  fecha         DateTime
  duracion      Int?      // minutos
  descripcion   String?
  estado        String    @default("pendiente") // "pendiente", "completada", "cancelada"
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  cliente       Cliente     @relation(fields: [clienteId], references: [id])
}

// Configuración de giros (editables)
model Giro {
  id          String    @id @default(cuid())
  nombre      String
  descripcion String?
  activo      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
